# Haar特征描述算子

[==参考资料==]([计算机视觉基础：Harr特征描述算子 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/152305364))

## 1.Harr特征算法

==类似于掩模运算，相邻相同大小的不同区域之间相互加减，即可得到的特征==

Haar(哈尔)特征分为三类：**边缘特征、线性特征、中心特征和对角线特征**，组合成特征模板。特征模板内有白色和黑色两种矩形，并**定义该模板的特征值为白色矩形像素和减去黑色矩形像素和**。Haar特征值反映了图像的灰度变化情况。

如：眼睛要比脸颊颜色要深，鼻梁两侧比鼻梁颜色要深，嘴巴比周围颜色要深等。但矩形特征只对一些简单的图形结构，如边缘、线段较敏感，所以只能描述特定走向（水平、垂直、对角）的结构。

![](图片\Harr1.png)

对于图中的A, B和D这类特征，特征数值计算公式为：v=Σ白-Σ黑，而对于C来说，计算公式如下：v=Σ白-2*Σ黑；之所以将黑色区域像素和乘以2，是为了使两种矩形区域中像素数目一致。

**上图的特征模板称为“特征原型”；特征原型在图像子窗口中扩展（平移伸缩）得到的特征称为“矩形特征”；矩形特征的值称为“特征值”。**

矩形特征可位于图像任意位置，大小也可以任意改变，所以矩形特征值是矩形模版类别、矩形位置和矩形大小这三个因素的函数。如：在24*24像素大小的检测窗口内矩形特征数量可以达到16万个。这样就有两个问题需要解决了：

（1）如何快速计算那么多的特征？---积分图大显神通；

（2）哪些矩形特征才是对分类器分类最有效的？---如通过AdaBoost算法来训练。

##2. Haar特征值归一化

跨度大的特性不利于量化评定特征值，所以需要进行“归一化”，压缩特征值范围。OpenCV采用如下方式“归一化”：(w,h为窗口的宽和高)

![](图片\OpenCV归一化方法.png)

## 3.积分图

### 3.1 积分图算法

[参考链接]([图像处理之图像积分图integral()_image integral (vrdelta method)_OliverH-yishuihan的博客-CSDN博客](https://blog.csdn.net/yishuihanq/article/details/108619478))

==简化每个区域内像素特征的计算公式，在原值的基础上计算起点到每个像素点的像素值得和，得到ii矩阵，则每个区域都只需要用ii矩阵的数据进行四次运算即可，注意ii矩阵第一行第一列全为0==

积分图就是只遍历一次图像就可以求出图像中所有区域像素和的快速算法，大大的提高了图像特征值计算的效率。

积分图主要的思想是**将图像从起点开始到各个点所形成的矩形区域像素之和作为一个数组的元素保存在内存中，当要计算某个区域的像素和时可以直接索引数组的元素，不用重新计算这个区域的像素和**，从而加快了计算（这有个相应的称呼，叫做动态规划算法）。



